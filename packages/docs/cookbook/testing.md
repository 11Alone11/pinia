# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â %{#testing-stores}%

–•—Ä–∞–Ω–∏–ª–∏—â–∞, –ø–æ —Å–≤–æ–µ–π —Å—É—Ç–∏, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–æ –º–Ω–æ–≥–∏—Ö –º–µ—Å—Ç–∞—Ö –∏ –º–æ–≥—É—Ç —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å. –ö —Å—á–∞—Å—Ç—å—é, —ç—Ç–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç–∞–∫. –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Ç—Ä–µ—Ö –≤–µ—â–∞—Ö:

- –≠–∫–∑–µ–º–ø–ª—è—Ä `pinia`: –•—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –Ω–µ–≥–æ
- `actions`: —á–∞—â–µ –≤—Å–µ–≥–æ –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–∞–º—É—é —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –Ω–∞—à–∏—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â. –ë—ã–ª–æ –±—ã –Ω–µ–ø–ª–æ—Ö–æ, –µ—Å–ª–∏ –±—ã –æ–Ω–∏ –∏–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å (mock) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?
- –ü–ª–∞–≥–∏–Ω—ã: –ï—Å–ª–∏ –≤—ã –ø–æ–ª–∞–≥–∞–µ—Ç–µ—Å—å –Ω–∞ –ø–ª–∞–≥–∏–Ω—ã, –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–ª–∏ –∫–∞–∫ –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ, –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ–± —ç—Ç–∏—Ö —Ç—Ä–µ—Ö –≤–µ—â–∞—Ö –ø–æ-—Ä–∞–∑–Ω–æ–º—É.

## –ú–æ–¥—É–ª—å–Ω–æ–µ (unit) —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ %{#unit-testing-a-store}%

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–≤ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω–æ–π —á–∞—Å—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `pinia`:

```js
// stores/counter.spec.ts
import { setActivePinia, createPinia } from 'pinia'
import { useCounterStore } from '../src/stores/counter'

describe('Counter Store', () => {
  beforeEach(() => {
    // —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä pinia –∏ –¥–µ–ª–∞–µ–º –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º,
    // —á—Ç–æ–±—ã –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª—é–±—ã–º –≤—ã–∑–æ–≤–æ–º useStore()
    // –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –µ–≥–æ –ø–µ—Ä–µ–¥–∞—á–∏: `useStore(pinia)`
    setActivePinia(createPinia())
  })

  it('increments', () => {
    const counter = useCounterStore()
    expect(counter.n).toBe(0)
    counter.increment()
    expect(counter.n).toBe(1)
  })

  it('increments by amount', () => {
    const counter = useCounterStore()
    counter.increment(10)
    expect(counter.n).toBe(10)
  })
})
```

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø–ª–∞–≥–∏–Ω—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å –æ–¥–Ω—É –≤–∞–∂–Ω—É—é –≤–µ—â—å: **–ø–ª–∞–≥–∏–Ω—ã –Ω–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ `pinia` –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ App**. –≠—Ç—É –ø—Ä–æ–±–ª–µ–º—É –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å, —Å–æ–∑–¥–∞–≤ –ø—É—Å—Ç–æ–µ –∏–ª–∏ –ø–æ–¥–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```js
import { setActivePinia, createPinia } from 'pinia'
import { createApp } from 'vue'
import { somePlugin } from '../src/stores/plugin'

// —Ç–æ—Ç –∂–µ –∫–æ–¥, —á—Ç–æ –∏ –≤—ã—à–µ...

// –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
const app = createApp({})
beforeEach(() => {
  const pinia = createPinia().use(somePlugin)
  app.use(pinia)
  setActivePinia(pinia)
})
```

## –ú–æ–¥—É–ª—å–Ω–æ–µ (unit) —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ %{#unit-testing-components}%

–≠—Ç–æ–≥–æ –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∏—á—å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `createTestingPinia()`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä pinia, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

–ù–∞—á–Ω–∏—Ç–µ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `@pinia/testing`:

```shell
npm i -D @pinia/testing
```

–ò –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞—Ç—å –≤ —Å–≤–æ–∏—Ö —Ç–µ—Å—Ç–∞—Ö —Ç–µ—Å—Ç–æ–≤—É—é pinia:

```js
import { mount } from '@vue/test-utils'
import { createTestingPinia } from '@pinia/testing'
// –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ª—é–±–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Å –∫–æ—Ç–æ—Ä—ã–º –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö
import { useSomeStore } from '@/stores/myStore'

const wrapper = mount(Counter, {
  global: {
    plugins: [createTestingPinia()],
  },
})

const store = useSomeStore() // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤–∞—è pinia!

// —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞–ø—Ä—è–º—É—é
store.name = 'my new name'
// —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ patch
store.$patch({ name: 'new name' })
expect(store.name).toBe('new name')

// –î–µ–π—Å—Ç–≤–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —è–≤–ª—è—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞–º–∏ (stubs), —Ç–æ –µ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Å–≤–æ–π –∫–æ–¥.
// –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∏–∂–µ.
store.someAction()

expect(store.someAction).toHaveBeenCalledTimes(1)
expect(store.someAction).toHaveBeenLastCalledWith()
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Vue 2, —Ç–æ –¥–ª—è `@vue/test-utils` —Ç—Ä–µ–±—É–µ—Ç—Å—è [–Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#Unit-test-components-Vue-2-).

### –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ %{#initial-state}%

–í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –≤–∞—à–∏—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–π pinia, –ø–µ—Ä–µ–¥–∞–≤ –æ–±—ä–µ–∫—Ç `initialState`. –≠—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–µ—Å—Ç–æ–≤–æ–π pinia –¥–ª—è _–∏–∑–º–µ–Ω–µ–Ω–∏—è (patch)_ —Ö—Ä–∞–Ω–∏–ª–∏—â –ø—Ä–∏ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–∏. –î–æ–ø—É—Å—Ç–∏–º, –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —ç—Ç–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```ts
import { defineStore } from 'pinia'

const useCounterStore = defineStore('counter', {
  state: () => ({ n: 0 }),
  // ...
})
```

–ü–æ—Å–∫–æ–ª—å–∫—É —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è _"counter"_, –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—ä–µ–∫—Ç –≤ `initialState`:

```ts
// –≥–¥–µ-–Ω–∏–±—É–¥—å –≤ –≤–∞—à–µ–º —Ç–µ—Å—Ç–µ
const wrapper = mount(Counter, {
  global: {
    plugins: [
      createTestingPinia({
        initialState: {
          counter: { n: 20 }, // –∑–∞–ø—É—Å–∫–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å 0, –∞ —Å 20
        },
      }),
    ],
  },
})

const store = useSomeStore() // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤–∞—è pinia!
store.n // 20
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π %{#—Åustomizing-behavior-of-actions}%

`createTestingPinia` –ø–æ–¥–º–µ–Ω—è–µ—Ç –∑–∞–≥–ª—É—à–∫–∞–º–∏ (stubs) –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â –æ—Ç–¥–µ–ª—å–Ω–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤, —É–∫–∞–∂–∏—Ç–µ `stubActions: false` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `createTestingPinia`:

```js
const wrapper = mount(Counter, {
  global: {
    plugins: [createTestingPinia({ stubActions: false })],
  },
})

const store = useSomeStore()

// –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç –≤—ã–∑–æ–≤ –ë–£–î–ï–¢ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
store.someAction()

// ...–Ω–æ –æ–Ω –≤—Å–µ –µ—â–µ –æ–±–µ—Ä–Ω—É—Ç —à–ø–∏–æ–Ω–æ–º (spy), —Ç–∞–∫ —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—ã–∑–æ–≤—ã
expect(store.someAction).toHaveBeenCalledTimes(1)
```

### –ò–º–∏—Ç–∞—Ü–∏—è (mocking) –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è %{#mocking-the-returned-value-of-action}%

–î–µ–π—Å—Ç–≤–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è, –Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø, –º—ã –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –æ–±–µ—Ä—Ç–∫—É —Ç–∏–ø–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–∏–ø `Mock` –∫ –∫–∞–∂–¥–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é. **–≠—Ç–æ—Ç —Ç–∏–ø –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**. –í–æ—Ç –ø—Ä–∏–º–µ—Ä —Å Vitest:

```ts
import type { Mock } from 'vitest'
import type { Store, StoreDefinition } from 'pinia'

function mockedStore<TStoreDef extends () => unknown>(
  useStore: TStoreDef
): TStoreDef extends StoreDefinition<
  infer Id,
  infer State,
  infer Getters,
  infer Actions
>
  ? Store<
      Id,
      State,
      Getters,
      {
        [K in keyof Actions]: Actions[K] extends (
          ...args: infer Args
        ) => infer ReturnT
          ? // üëá –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            Mock<Args, ReturnT>
          : Actions[K]
      }
    >
  : ReturnType<TStoreDef> {
  return useStore() as any
}
```

–≠—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

```ts
import { mockedStore } from './mockedStore'
import { useSomeStore } from '@/stores/myStore'

const store = mockedStore(useSomeStore)
// —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!
store.someAction.mockResolvedValue('some value')
```

### –£–∫–∞–∑–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ createSpy %{#specifying-the-createspy-function}%

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Jest –∏–ª–∏ vitest —Å `globals: true`, `createTestingPinia` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ (stubs) –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ —à–ø–∏–æ–Ω–æ–≤ (spy) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ (`jest.fn` –∏–ª–∏ `vitest.fn`). –ï—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `globals: true` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, —Ç–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –æ–ø—Ü–∏—é [createSpy](/api/interfaces/pinia_testing.TestingOptions.html#createspy):

::: code-group

```ts [vitest]
// –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `globals: true`
import { vi } from 'vitest'

createTestingPinia({
  createSpy: vi.fn,
})
```

```ts [sinon]
import sinon from 'sinon'

createTestingPinia({
  createSpy: sinon.spy,
})
```

:::

–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [—Ç–µ—Å—Ç–∞—Ö –ø–∞–∫–µ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](https://github.com/vuejs/pinia/blob/v2/packages/testing/src/testing.spec.ts).

### –ò–º–∏—Ç–∞—Ü–∏—è (mocking) –≥–µ—Ç—Ç–µ—Ä–æ–≤ %{#mocking-getters}%

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª—é–±–æ–π –≥–µ—Ç—Ç–µ—Ä –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è –∫–∞–∫ –∏ –ø—Ä–∏ –æ–±—ã—á–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –≥–µ—Ç—Ç–µ—Ä –≤ –ª—é–±–æ–µ –Ω—É–∂–Ω–æ–µ –≤–∞–º –∑–Ω–∞—á–µ–Ω–∏–µ:

```ts
import { defineStore } from 'pinia'
import { createTestingPinia } from '@pinia/testing'

const useCounterStore = defineStore('counter', {
  state: () => ({ n: 1 }),
  getters: {
    double: (state) => state.n * 2,
  },
})

const pinia = createTestingPinia()
const counter = useCounterStore(pinia)

counter.double = 3 // ü™Ñ –≥–µ—Ç—Ç–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–∞—Ö

// —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ undefined, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
// @ts-expect-error: –æ–±—ã—á–Ω–æ —ç—Ç–æ —á–∏—Å–ª–æ
counter.double = undefined
counter.double // 2 (=1 x 2)
```

### –ü–ª–∞–≥–∏–Ω—ã Pinia %{#pinia-plugins}%

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –ø–ª–∞–≥–∏–Ω—ã pinia, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∏—Ö –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `createTestingPinia()`, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã. **–ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏—Ö —Å –ø–æ–º–æ—â—å—é `testingPinia.use(MyPlugin)`**, –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ –±—ã —Å–¥–µ–ª–∞–Ω–æ —Å –æ–±—ã—á–Ω—ã–º pinia:

```js
import { createTestingPinia } from '@pinia/testing'
import { somePlugin } from '../src/stores/plugin'

// –≤–Ω—É—Ç—Ä–∏ –∫–∞–∫–æ–≥–æ-–Ω–∏–±—É–¥—å —Ç–µ—Å—Ç–∞
const wrapper = mount(Counter, {
  global: {
    plugins: [
      createTestingPinia({
        stubActions: false,
        plugins: [somePlugin],
      }),
    ],
  },
})
```

## E2E-—Ç–µ—Å—Ç—ã %{#e2e-tests}%

–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è Pinia, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –¥–ª—è E2E-—Ç–µ—Å—Ç–æ–≤, –≤ —ç—Ç–æ–º –≤—Å—è —Å—É—Ç—å —ç—Ç–∏—Ö —Ç–µ—Å—Ç–æ–≤! –í—ã –º–æ–∂–µ—Ç–µ, –≤–æ–∑–º–æ–∂–Ω–æ, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã, –Ω–æ —ç—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ üòÑ.

## –ú–æ–¥—É–ª—å–Ω–æ–µ (unit) —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Vue 2) %{#unit-test-components-vue-2}%

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ [Vue Test Utils 1](https://v1.test-utils.vuejs.org/) —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Pinia –Ω–∞ `localVue`:

```js
import { PiniaVuePlugin } from 'pinia'
import { createLocalVue, mount } from '@vue/test-utils'
import { createTestingPinia } from '@pinia/testing'

const localVue = createLocalVue()
localVue.use(PiniaVuePlugin)

const wrapper = mount(Counter, {
  localVue,
  pinia: createTestingPinia(),
})

const store = useSomeStore() // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤–∞—è pinia!
```
